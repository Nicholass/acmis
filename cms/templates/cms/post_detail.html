{% extends 'cms/base.html' %}
{% load i18n %}
{% load comments %}
{% load auth %}
{% load bleach_tags %}
{% load opengraph %}
{% load bleach_src_filter %}

{% block title %}{{ post.title }}{% endblock %}

{% block og %}
    {% if post.category.route == 'photo' or post.category.route == 'drawing' %}
        {% opengraph title=post.title description=post.description image=post.file %}
    {% else %}
        {% opengraph title=post.title description=post.text|striptags|truncatechars:400 %}
    {% endif %}
{% endblock %}

{% block breadcrumbs %}
    <li><a href="/">{% trans "Blog" %}</a></li>
    <li>
        <a href="{% url 'category_list' category=post.category.route %}">
            {{ post.category.name }}
        </a>
    </li>
{% endblock %}

{% block content %}
    {% comment_count as comm_count %}

    <div class="post single">
        <h1>{{ post.title }}</h1>

        <div class="info">
            <span>{{ post.created_date }}</span>
            <span><a href="{% url 'author_list' author=post.author %}">{{ post.author }}</a></span>
        </div>

        <div class="post-content clearfix">
            {{ post.text|bleach_src|bleach }}
        </div>

        {% if post.tags.all %}
            <div class="tags">
                {% for tag in post.tags.all %}
                    {% if not forloop.first %}&nbsp;{% endif %}
                    <a href="{% url 'tag_list' tags=tag.name %}">#{{ tag.name }}</a>
                    {% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        <div class="actions">
            {% if user.is_authenticated %}
                {% auth_is_owner post as is_post_owner %}

                {% if perms.cms.change_cmspost and is_post_owner %}
                    <a href="{% url 'post_edit' pk=post.pk %}">{% trans " Edit" %}</a>
                {% endif %}

                {% if perms.cms.delete_cmspost and is_post_owner %}
                    <a href="{% url 'post_delete' pk=post.pk %}"
                       onclick="return confirm('{% trans "Are you sure you want to delete the post? Cancel this action will be impossible." %}')">{% trans " Delete" %}</a>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="comments">
        {% if comm_count %}{% comment_list %}{% endif %}

        {% if perms.cms.add_comment %}
            {% comment_form post %}
        {% endif %}
    </div>
{% endblock %}